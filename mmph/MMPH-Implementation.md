# –û—Ç—á–µ—Ç: Monotone Minimal Perfect Hashing (MMPH)

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã

**Monotone Minimal Perfect Hash Function (MMPH)** ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è $h$, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–∞–±–æ—Ä –∏–∑ $n$ –∫–ª—é—á–µ–π $S$ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–ª—ã—Ö
—á–∏—Å–µ–ª $[0, n-1]$ —Ç–∞–∫, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ –∫–ª—é—á–µ–π.

–ï—Å–ª–∏ $key_1 < key_2$, —Ç–æ $h(key_1) < h(key_2)$. –ü–æ —Å—É—Ç–∏, —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è —Ä–∞–Ω–≥ (–ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä) –∫–ª—é—á–∞ –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ
–∑–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è.

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Go

–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ Go –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≥–æ—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–∂–∞—Ç–∏—è MMPH. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä,
`alecthomas/mph`) —Ä–µ–∞–ª–∏–∑—É—é—Ç –æ–±—ã—á–Ω–æ–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (MPH), –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫.

## 2. –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—å–∏ 2009 –≥.)

–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç—É [¬´Monotone Minimal Perfect Hashing¬ª](https://vigna.di.unimi.it/ftp/papers/MonotoneMinimalPerfectHashing.pdf), —Å—É—â–µ—Å—Ç–≤—É—é—Ç
–¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–¥—Ö–æ–¥–∞, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—â–∏—Ö –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏. –ó–¥–µ—Å—å $n$ ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π, $w$ ‚Äî –¥–ª–∏–Ω–∞ –º–∞—à–∏–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä,
64 –±–∏—Ç–∞).

### –ú–µ—Ç–æ–¥ –ê: Bucketing with LCP (–°–∫–æ—Ä–æ—Å—Ç—å)

see [bucket-mmph](bucket-mmph)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∏–±–æ–ª—å—à–∏—Ö –æ–±—â–∏—Ö –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤.

- **–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞**: $O(1)$
- **–ü–∞–º—è—Ç—å**: $O(n \log w)$ –±–∏—Ç
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –º–µ—Ç–æ–¥ –∏–∑ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö, –Ω–æ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏, —á–µ–º –≤–∞—Ä–∏–∞–Ω—Ç —Å Trie

### –ú–µ—Ç–æ–¥ –ë: Hash Displace and Compress (MMPH)

see [rbtz-mmph](rbtz-mmph/)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º –∏ —Å–∂–∞—Ç–∏–µ–º, –æ–ø–∏—Å–∞–Ω–Ω–æ–µ –≤
—Å—Ç–∞—Ç—å–µ [Hash, displace, and compress](https://cmph.sourceforge.net/papers/esa09.pdf). –ü–æ—Å–∫–æ–ª—å–∫—É –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–¥–µ—Ä–∂–∫–∏ - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤,
–∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–ª—É—á–∞–µ—Ç—Å—è –¥–æ–≤–æ–ª—å–Ω–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º, –Ω–∞ —É—Ä–æ–≤–Ω–µ LCP Bucketing.

- **–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞**: $O(1)$
- **–ü–∞–º—è—Ç—å**: $O(n \log n)$ –±–∏—Ç (–¥–≤–∞ –º–∞—Å—Å–∏–≤–∞ uint32)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è MMPH, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –±–ª–∞–≥–æ–¥–∞—Ä—è —Ö—Ä–∞–Ω–µ–Ω–∏—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

### –ú–µ—Ç–æ–¥ –í: Probabilistic Trie (–°–∂–∞—Ç–∏–µ)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–µ –¥–µ—Ä–µ–≤—å—è (z-fast trie) –∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ.

- **–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞**: $O(\log w)$ (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç $n$, —Ç–æ–ª—å–∫–æ –æ—Ç —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏ –∫–ª—é—á–∞)
- **–ü–∞–º—è—Ç—å**: $O(n \log \log w)$ –±–∏—Ç
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ 2-3 –±–∏—Ç–∞ –Ω–∞ –∫–ª—é—á), –Ω–æ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

## 3. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã (State-of-the-Art)

### LeMonHash (Learned Monotone Minimal Perfect Hashing)

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ (–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ 2023 –≥–æ–¥—É), –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –∫–æ–Ω—Ü–µ–ø—Ü–∏—é Learned Indexes –≤–º–µ—Å—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PGM-index (Piecewise Geometric Model) –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫—É—Å–æ—á–Ω–æ-–ª–∏–Ω–µ–π–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∞–ø–ø—Ä–æ–∫—Å–∏–º–∏—Ä—É—é—â–µ–π –≥—Ä–∞—Ñ–∏–∫
–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–ª—é—á–∞ –æ—Ç –µ–≥–æ —Ä–∞–Ω–≥–∞. –ö–æ–ª–ª–∏–∑–∏–∏ –∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã BuRR.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:

- **–ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å**: –î–æ—Å—Ç–∏–≥–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ 1.3 ‚Äì 3 –±–∏—Ç–∞ –Ω–∞ –∫–ª—é—á, —á—Ç–æ —á–∞—Å—Ç–æ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ Trie
- **–°–∫–æ—Ä–æ—Å—Ç—å**: –ë–ª–∞–≥–æ–¥–∞—Ä—è "–ø–ª–æ—Å–∫–æ–π" —Å—Ç—Ä—É–∫—Ç—É—Ä–µ (–≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—è–º) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è, —É–¥–æ–±–Ω—É—é –¥–ª—è
  –ø—Ä–µ—Ñ–µ—Ç—á–∏–Ω–≥–∞ CPU

**–°—Ç–∞—Ç—É—Å**: –°—É—â–µ—Å—Ç–≤—É–µ—Ç —ç—Ç–∞–ª–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ C++ ([GitHub: ByteHamster/LeMonHash](https://github.com/ByteHamster/LeMonHash)). –ü–æ—Ä—Ç–æ–≤ –Ω–∞ Go
–ø–æ–∫–∞ –Ω–µ—Ç.

## 4. –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∞—Å–∏–º–ø—Ç–æ—Ç–∏–∫

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ Workaround'–∞.

| –ú–µ—Ç–æ–¥                                  | –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ (Query)  | –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (Space) |
|----------------------------------------|------------------------|----------------------------|
| MMPH: LCP Bucketing                    | $O(1)$                 | $O(n \log w)$              |
| MMPH: Hash Displace and Compress (hdc) | $O(1)$                 | $O(n \log n)$              |
| MMPH: Relative Trie                    | $O(\log w)$            | $O(n \log \log w)$         |
| LeMonHash (Learned)                    | –ë—ã—Å—Ç—Ä–æ (Math + Lookup) | $? O(n) –Ω–æ –∫–∞–∫ ? $         |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: $n$ ‚Äî –∫–æ–ª-–≤–æ –∫–ª—é—á–µ–π, $w$ ‚Äî –¥–ª–∏–Ω–∞ –∫–ª—é—á–∞ –≤ –±–∏—Ç–∞—Ö (–æ–±—ã—á–Ω–æ 64).

## 5. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

# üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ MPH –°—Ç—Ä—É–∫—Ç—É—Ä: `hdc-rbtz` vs `lcp-bucketing`

## üèó Build Time (ns)

| Keys       | rbtz           | bucket         |
|------------|----------------|----------------|
| 32         | 16,338         | 15,424         |
| 256        | 53,985         | 76,537         |
| 1,024      | 259,469        | 428,988        |
| 8,192      | 2,371,186      | 3,671,151      |
| 32,768     | 10,038,608     | 17,648,310     |
| 262,144    | 108,401,879    | 134,163,823    |
| 1,048,576  | 480,714,931    | 737,158,792    |
| 4,194,304  | 2,220,704,042  | 3,582,287,916  |
| 16,777,216 | 11,705,159,417 | 16,250,687,375 |

## üß† Bits per Key (in memory)

| Keys       | rbtz  | bucket |
|------------|-------|--------|
| 32         | 44.00 | 76.00  |
| 256        | 40.50 | 61.62  |
| 1,024      | 40.12 | 51.12  |
| 8,192      | 40.02 | 48.56  |
| 32,768     | 40.00 | 46.54  |
| 262,144    | 40.00 | 44.59  |
| 1,048,576  | 40.00 | 43.56  |
| 4,194,304  | 40.00 | 42.69  |
| 16,777,216 | 40.00 | 41.96  |

## ‚ö° Lookup Time (ns)

| Keys       | rbtz  | bucket |
|------------|-------|--------|
| 32         | 4.918 | 120.0  |
| 256        | 4.651 | 138.7  |
| 1,024      | 4.845 | 147.2  |
| 8,192      | 4.823 | 158.0  |
| 32,768     | 5.197 | 166.5  |
| 262,144    | 6.158 | 180.7  |
| 1,048,576  | 6.204 | 233.3  |
| 4,194,304  | 16.32 | 374.0  |
| 16,777,216 | 38.33 | 391.3  |

## –í—ã–≤–æ–¥:

–ü–æ–∫–∞ —á—Ç–æ —É –º–µ–Ω—è –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Bucketing, —Ç–∞–º –º–Ω–æ–≥–æ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤

![img.png](imgs/cmp-hdc-buck-img.png)

## –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞

- [Monotone Minimal Perfect Hashing: Searching a Sorted Table with O(1) Accesses](https://vigna.di.unimi.it/ftp/papers/MonotoneMinimalPerfectHashing.pdf) -
  Belazzougui D., Boldi P., Pagh R., Vigna S.
- [Hash, displace, and compress](https://cmph.sourceforge.net/papers/esa09.pdf)
- [LeMonHash: Learned Monotone Minimal Perfect Hashing](https://github.com/ByteHamster/LeMonHash) - GitHub Repository
